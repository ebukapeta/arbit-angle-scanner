<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Triangular Arbitrage Scanner</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  body { font-family: Inter, Arial, sans-serif; margin: 20px; background:#0b1020; color:#e6e8ef; }
  .panel { background:#0f1626; padding:16px; border-radius:12px; border:1px solid #22304b; }
  h1 { margin:0 0 12px 0; color:#9fc5ff; }
  .controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  select,multi, input { padding:8px 10px; border-radius:8px; border:1px solid #22304b; background:#071026; color:#e6e8ef; }
  .btn { background:#0d6efd; color:white; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:600; }
  table { width:100%; border-collapse:collapse; margin-top:16px; }
  th,td { padding:10px 12px; border-bottom:1px solid #22304b; text-align:left; }
  th { color:#b8c1d1; background:#0f1626; position:sticky; top:0; }
  .num { text-align:right; font-variant-numeric:tabular-nums; }
  .pos { color:#12d18e; } .neg { color:#ff6b6b; }
</style>
</head>
<body>
  <div class="panel">
    <h1>Triangular Arbitrage (spot â€¢ market price)</h1>
    <div class="controls">
      <label>Exchanges:</label>
      <select id="exchanges" multiple size="5" style="min-width:180px;">
        <option value="binance" selected>Binance</option>
        <option value="kucoin" selected>KuCoin</option>
        <option value="bybit" selected>Bybit</option>
        <option value="gateio" selected>Gate.io</option>
        <option value="kraken" selected>Kraken</option>
      </select>

      <label>Min Profit %</label>
      <input id="minProfit" type="number" step="0.1" value="1" style="width:100px;"/>

      <button id="scanBtn" class="btn">Scan Now</button>
      <div id="status" style="margin-left:8px;color:#9aa3b2;"></div>
    </div>
  </div>

  <div class="panel" style="margin-top:12px;">
    <table id="results">
      <thead>
        <tr>
          <th style="width:60px">#</th>
          <th>Triangle Route</th>
          <th class="num">Profit Before (%)</th>
          <th class="num">Fees (%)</th>
          <th class="num">Profit After (%)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const scanBtn = document.getElementById('scanBtn');
const status = document.getElementById('status');
const tbody = document.querySelector('#results tbody');
const minInput = document.getElementById('minProfit');
const exchSelect = document.getElementById('exchanges');

scanBtn.addEventListener('click', async () => {
  const selected = Array.from(exchSelect.selectedOptions).map(o => o.value);
  const minProfit = parseFloat(minInput.value || '0');

  status.textContent = 'Scanning...';
  tbody.innerHTML = '';

  try {
    const res = await fetch('/scan', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ exchanges: selected, min_profit: minProfit })
    });
    if (!res.ok) throw new Error('Network response not ok');

    const data = await res.json();
    const rows = data.opportunities || [];
    if (!rows.length) {
      status.textContent = 'No opportunities found.';
      return;
    }

    rows.forEach((r, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td style="max-width:600px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${r.route}</td>
        <td class="num ${r.profit_before>=0?'pos':'neg'}">${r.profit_before.toFixed(2)}</td>
        <td class="num">${r.fee.toFixed(2)}</td>
        <td class="num ${r.profit_after>=0?'pos':'neg'}">${r.profit_after.toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });

    status.textContent = `${rows.length} opportunities`;
  } catch (e) {
    status.textContent = 'Error: ' + e.message;
  }
});
</script>
</body>
</html>
