<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Triangular Arbitrage Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #111827; /* dark theme */
      color: #f9fafb;
      font-family: system-ui, sans-serif;
    }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    @media (min-width: 768px) {
      .controls {
        flex-direction: row;
        align-items: center;
      }
    }
    th {
      color: #2563eb; /* blue header text */
    }
    .profit-positive { color: #10b981; font-weight: 600; } /* green */
    .profit-negative { color: #ef4444; font-weight: 600; } /* red */
    .results-table {
      max-height: 70vh;   /* taller scrollable area */
      overflow-y: auto;
      overflow-x: auto;
    }
  </style>
</head>
<body class="p-4">
  <!-- Scanner Title -->
  <div class="text-center mb-6">
    <h1 class="inline-block bg-blue-600 text-white px-4 py-2 rounded-lg text-2xl font-bold">
      Triangular Arbitrage Scanner
    </h1>
  </div>

  <!-- Scanner Controls -->
  <div class="controls mb-6 justify-center">
    <div>
      <label for="exchange" class="block mb-1">Exchange:</label>
      <select id="exchange" class="p-2 rounded bg-gray-800 text-white w-48">
        <option value="binance">Binance</option>
        <option value="bybit">Bybit</option>
        <option value="kucoin">KuCoin</option>
        <option value="gate">Gate.io</option>
      </select>
    </div>
    <div>
      <label for="minProfit" class="block mb-1">Min profit % (before fees):</label>
      <input id="minProfit" type="number" step="0.1" value="0.3" 
        class="p-2 rounded bg-gray-800 text-white w-32" />
    </div>
    <div class="flex items-end">
      <button onclick="startScan()" 
        class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white font-medium">
        Scan
      </button>
    </div>
  </div>

  <!-- Results -->
  <div id="results"></div>

  <script>
    async function startScan() {
      const exchange = document.getElementById('exchange').value;
      const minProfit = parseFloat(document.getElementById('minProfit').value);
      const resultsDiv = document.getElementById('results');

      resultsDiv.innerHTML = `<p class="text-center text-gray-400">Scanning ${exchange}...</p>`;

      try {
        const res = await fetch('/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ exchanges: [exchange], min_profit: minProfit })
        });
        if (!res.ok) throw new Error("Scan request failed");
        const data = await res.json();

        if (!data.results || data.results.length === 0) {
          resultsDiv.innerHTML = `<p class="text-center text-gray-400">No opportunities found.</p>`;
          return;
        }

        // Build results table
        let html = `
          <div class="results-table">
            <table class="table-auto w-full border border-gray-700 text-sm">
              <thead class="bg-gray-900">
                <tr>
                  <th class="px-3 py-2 border border-gray-700">#</th>
                  <th class="px-3 py-2 border border-gray-700">Triangle</th>
                  <th class="px-3 py-2 border border-gray-700">Pairs</th>
                  <th class="px-3 py-2 border border-gray-700">Profit Before %</th>
                  <th class="px-3 py-2 border border-gray-700">Fees %</th>
                  <th class="px-3 py-2 border border-gray-700">Profit After %</th>
                </tr>
              </thead>
              <tbody>
        `;

        data.results.forEach((r, i) => {
          const profitClass = r.profit_after_fees >= 0 ? "profit-positive" : "profit-negative";
          html += `
            <tr class="hover:bg-gray-800">
              <td class="px-3 py-2 border border-gray-700 text-center">${i + 1}</td>
              <td class="px-3 py-2 border border-gray-700">${r.triangle}</td>
              <td class="px-3 py-2 border border-gray-700">${r.pairs}</td>
              <td class="px-3 py-2 border border-gray-700">${r.profit_before_fees.toFixed(2)}</td>
              <td class="px-3 py-2 border border-gray-700">${r.trade_fees.toFixed(3)}</td>
              <td class="px-3 py-2 border border-gray-700 ${profitClass}">${r.profit_after_fees.toFixed(2)}</td>
            </tr>
          `;
        });

        html += `</tbody></table></div>`;
        resultsDiv.innerHTML = html;

      } catch (err) {
        resultsDiv.innerHTML = `<p class="text-red-500 text-center">Error scanning exchanges. Check server logs.</p>`;
      }
    }
  </script>
</body>
</html>
